在生成环境中运行云原生应用程序
----------------------------------------------

将软件部署到生产环境的过程是十分有挑战性的。有些流程本意是为了**降低风险和提高效率**，但无意中却起到了相反的效果，因为其过程又慢又麻烦。在部署后，**保持应用程序的正常运行**也同样困难。

如今生产环境变得如此脆弱的原因并不在于任何特定的团队或者个人，“罪魁祸首”是**整个行业中几乎无处不在的一系列企业行为和运营实践**。

解决方案是**设计一个不把生产环境运维看作一个孤立的行为，而是将软件开发的实践和架构模式与在生成环境中部署和管理软件的活动联系起来**的新系统。



### 部署云原生应用程序所面临的困难

我们所面临的挑战在于不经意间设置了一系列阻碍成功的行为方式。尽管面临的每个挑战都不同，但几乎所有企业都存在一个常见问题。

![导致软件难以部署和无法在生产环境保持良好运行的原因](../assets/figure_2-1.jpg)

* 碎片化的变化：**在软件开发生命周期中存在不断出现的变化**，不仅会对初次部署造成影响，还会影响应用程序后续的稳定性。最终会导致部署的软件与部署环境之间存在着不一致性。
* 有风险的部署：部署在复杂网络中的**某个组件如果发生了变化，可能会引起系统的其他部分出现连锁反应**，从而导致风险。风险的恐惧感会产生下游反应，降低后续部署的频率。
* 认为变化是例外：希望软件底层依赖的系统是稳定的这种想法是不靠谱的。**基础架构的任何不稳定都会影响到正在运行的应用程序**，这会使得应用程序难以保持正常的运行状态。
* 生产环境的不稳定性：生**产环境自身的不稳定性**通常会带来更多的麻烦，最终限制生产环境的部署频率。

#### 碎片化的变化

在软件开发生命周期中通常会有两个方面会不断发生变化：

* **环境发生变化**：常见的例子时所部署软件的依赖包存在差异，或者是服务器系统配置存在差异。
* **部署的构件发生变化**：任何对可部署构件的重新编译或者重新打包都可能而且经常地引入其他的差异（配置文件的修改，或者所依赖的库文件等）。

#### 有风险的部署

为了应对部署的风险，一般的做法是创建大量的工具和流程来减少部署的风险。这种做法的核心在于**通过大量的前期工作来减少失败的可能性**。

这种做法会导致发布的频次变低，而**低频次的发布会导致每次部署包含更多的变更，也会对系统其它部分造成更多的影响**。

#### 认为变化是例外

在业务中**唯一的不变就是变化**，对于云环境上的系统来说，它们都将持续经历不稳定和变化。

#### 生产环境的不稳定性

生成环境自身的不稳定进一步增加了部署的难度。将应用程序部署到一个已经不稳定的环境是不明智的。相对稳定的环境是进行部署的先决条件。



### 解决办法

解决问题的办法是使用CICD（Continuous Integration, Continuous Delivery/Deployment，持续集成，持续交付/部署）这个新的IT运维模型。将其作为主要的驱动力量，重新设计整个软件开发声明周期的流程。这样可以显著简化部署过程，并为整个系统带来很多好处。

![围绕CICD打造一个有效、可预测、文档的系统](../assets/figure_2-2.jpg)
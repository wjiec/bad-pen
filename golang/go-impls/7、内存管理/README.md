内存管理
---

内存管理是运行时的另一部分，主要负责应用程序如何申请、分配和回收内存，尤其是栈上和堆中的内存都是如何被管理和分配的。



### 内存分配器

内存空间包含两个重要区域：栈区和堆区。函数调用的参数、返回值以及局部变量大都会被分配到栈上，**由编译器负责管理**。堆中的对象**由内存分配器分配并由垃圾收集器回收**。

#### 分配原理

Go 语言的内存分配器借鉴 TCMalloc 的设计实现高速内存分配，其核心理念是使用多级缓存将对象根据大小分类，并按照类别实施不同的分配策略。

内存分配器不仅会区别对待大小不同的对象，还会将内存分成不同等级分别管理。内存分配器引入线程缓存（thread cache）、中心缓存（central cache）和堆（heap）3 个组件分级管理内存。

#### 稀疏内存

使用稀疏内存布局不仅能移除堆大小的上限，还能解决 C 语言和 Go 语言混合使用时的地址空间冲突问题。不过基于稀疏内存的内存管理失去了内存连续性这一假设，使得内存管理变得更加复杂。
语言特性
------------

在 Go 中有 3 个比较有特色的特性，分别是函数调用、接口和反射。



### 函数调用

函数在 Go 语言中是一等公民。在 Go 语言中会同时使用寄存器和栈传递参数和返回值。同时无论是传递基本类型、结构体还是指针，都会对传递的参数进行复制。



### 接口

Go 语言中的接口是一组方法的签名，它是 Go 语言的重要组成部分。在 Go 语言中，实现接口不需要显式的引用，只需要实现接口内的方法即可（名字、参数、返回值相同），Go 语言只会在传递参数、返回参数以及变量赋值时才会检查某个类型是否实现了接口。

#### 类型

接口也是 Go 语言中的一种类型，它能够出现在变量的定义、函数的入参和返回值中并对它们进行约束。在运行时，Go 语言使用 `runtime.iface` 表示带有一组方法的接口，使用 `runtime.eface` 表示不带任何方法的 `interface{}`。

#### 方法集

在 Go 语言中，接口在定义一组方法时没有对实现的接收者左限制。我们在实现接口时，选择使用指针或者值类型的接受者会有一些限制，这些限制的根本原因是：

* 在 Go 语言中，值类型并不总是能获取地址（不可寻址），例如在 map 中的键和值
* 而一个指针总是可以被解引用得到其值类型的

以上差异导致了我们在实现一个接口时，如果使用指针类型的接受者实现一个接口而传递了一个值类型的情况下编译器会报错，而值类型的接受者可以使用值类型或指针来初始化一个接口。

#### 数据结构

在接口的运行时表示中，存在 `runtime._type` 结构体，这是 Go 语言类型在运行时的表示，其中包含类型的大小、哈希、对齐以及种类等。接口与实际类型的转换都是通过对 `runtime._type` 结构体中 `hash` 字段的运用实现的。

#### 动态派发

在 `runtime._itab` 结构体中 `fun` 字段保存了实际的实现类型对应接口实现的函数指针在内存中的位置。



### 反射

`relect` 实现了运行时的反射能力，能够让程序操作不同类型的对象。在 Go 语言中反射由三大法则：

* `interface{}` 变量可以转换成反射对象
* 从反射对象可以获取 `interface{}` 变量
* 要修改反射对象，其值必须可设置

反射的实现原理就是将任意的值转换为 `interface{}` 并通过指针获取 `runtime.eface` 结构体中的 `runtime._type` 字段和 `ptr` 的值。
7、发布控制器和 Operator
---

打包和分发控制器和 Operator，处理版本升级。



### 生命周期管理和打包

我们需要交付的文件包括：用于定义控制器的可执行文件的 YAML 清单文件、CRD 以及安全相关的资源、服务账号以及必要的 RBAC 权限的清单。

#### Helm

Helm 定位于称为 Kubernetes 打包管理器的事实标准。Helm 引入一个名为 chart 的概念，帮助我们安装或升级 Kubernetes 应用。

#### Kustomize

Kustomize 提供了对 Kubernetes 资源配置文件的一种声明式配置方法，我们可以在 kubectl 命令行上加上 -k 参数来激活它。

#### 打包的最佳实践

* 提供一个合适的准入控制设置，只需要基于最小权限完成 RBAC 许可
* 思考控制器的管辖范围
* 测试和分析控制器以使得你对它运行所需要的资源以及其扩展性有所概念
* 确保 CRD 和控制器有齐全的文档

#### 生命周期管理

一个更加广泛和全面的话题是生命周期管理。它的基本思想是考虑从开发到发布到升级整个供应链，把这整个过程的自动化做到极致。



### 准生产部署

满足以下检查表的所有内容：

* 使用 Deployment 或者 DaemonSet 来管理你的自定义控制器
* 对特定端点进行健康检查，进行存活和可用性检测
* 考虑主从/冷备模型（**需要注意状态同步是一个重要且不简单的工作**） 
* 提供访问控制资源，例如这服务账号和角色，且遵循最小特权原则。
* 考虑自动化构建和测试




运行于Kubernetes中的容器：Pod
-----------------------------------------------

**Pod是Kubernetes中最为重要的核心概念**，而其他对象仅仅在管理、暴露Pod或被Pod使用。

### 介绍Pod

Pod是一组容器的组合，代表了Kubernetes中的基本构建模块。当一个Pod包含多个容器时，这些**容器总是运行于同一个工作节点**上（一个Pod绝不会跨越多个工作节点）。

#### 为何多个容器比单个容器多个进程好

**容器被设计为每个容器只运行一个进程**（除非进程本身产生子进程）。如果在单个容器中运行多个进程，那么保持所有进程运行，管理它们的日志等都将会是我们的责任。

#### 了解Pod中共享和隔离的资源

由于不能将多个进程聚集在一个单独的容器中，我们就需要另一种更高级的的机构来将容器绑定在一起，并将它们作为一个单元进行管理，这就是Pod出现的根本原因。

在Pod下，我们可以运行一些密切相关的进程，并为它们提供（几乎）相同的环境，而且这些进程**好像全部运行于单个容器中，同时又保持一定的隔离**。这样一来我们就可以全面利用容器所提供的特性，同时对这些进程来说就像运行在一起一样，实现两全其美。

##### Pod中容器之间的资源共享

因为Kubernetes中管理的基本单位是Pod，所以我们需要**每个容器组之间共享一些资源**。Kubernetes通过配置Docker来让**一个Pod内的所有容器共享相同的Linux命名空间**。

* Pod下的**容器都在相同的Network和UTS命名空间**下（共享相同的主机名和网络接口）
  * 需要注意同一Pod下的容器运行的进程不能绑定到相同的端口号（端口冲突）
  * 同一Pod下的容器具有相同的loopback网络接口，因此容器可以通过localhost与同一Pod的其他容器进行通信。
* Pod下的**容器都在相同的IPC命名空间**下运行，因此他们能通过IPC进行通信
* *在最新的Kubernetes中，它们特能共享相同的PID命名空间（默认未激活）*
* 默认情况下，**每个容器的文件系统与其他容器完全隔离**（但是可以使用名为Volume的Kubernetes资源来共享文件目录）

##### Pod之间的平坦网络

Kubernetes集群的所有Pod都在同一个共享网络地址空间中，这意味着每个Pod都可以通过其他Pod的IP地址来实现相互访问。不论是将两个Pod安排在单一的还是不同的工作节点上，同时不管实际节点的网络拓扑结构如何，这些Pod内的容器都能够像在无NAT的平坦网络中一样相互通信。